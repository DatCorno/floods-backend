[tox]
envlist = py36, flake8, pylint, doc8

[testenv]
deps = 
    -r{toxinidir}/ccai/tests/requirements.txt
    passenv

commands =
    pytest

# Pytest configuration
[pytest]
addopts = --color=yes
norecursedirs = .* *.egg* config docs dist build
xfail_strict = True


# Flake8 configuration, following documentation guidelines
[flake8]
# Print total number of errors
count = True
# Show the source causing the error
show-source = True
# Run PyFlake on docs too
doctests = True
# Ignore these for documentation
ignore = 
    D205
    D400
# Exclude the following files
exclude = 
    .tox,
    .git,
    __pycache__,
    config,
    build,
    dist,
    *.pyc.
    *.egg-info,
    .cache,
    .eggs,

max-line-length = 100
max-complexity = 20
import-order-style = google
application-import-name = ccai

# Doc8 configuration
[doc8]
max-line-length = 100
file-encoding = utf-8

# Flake8 environment
[testenv:flake8]
description = Run flake8 on the project.
skip_install = True
deps = 
    flake8
    flake8-import-order
    flake8-docstrings
    flake8-bugbear
commands = 
    flake8 ccai/ setup.py

# Pylint environment
[testenv:pylint]
description = Perform static analysis with pylint
skip_install = False
deps = pylint
commands =
    pylint ccai/

[testenv:doc8]
description = Perform static analysis of the docstrings with doc8
skip_install = True
deps = 
    -rdocs/requirements.txt
    doc8
commands = 
    doc8 docs/

# Documentation environments
[testenv:docs]
description = Invoke Sphinx to build the documentation
deps =
    -rdocs/requirements.txt
commands = 
    sphinx-build -E -W --color -c docs/src -b html docs/src docs/build/html
    sphinx-build -E -W --color -c docs/src -b man docs/src docs/build/html

[testenv:host-docs]
description = Host the documentation on the localhost
skip_install = True
changedir = docs/build/html
commands = 
    python -m http.server 8000 --bind 127.0.0.1
